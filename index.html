<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>GreenQuest ‚Äî Gamified Eco Learning</title>
<meta name="description" content="GreenQuest ‚Äî lightweight browser games for environmental education: Recycle Sorting, Tree Planting, Ocean Cleanup.">
<style>
  /* --- Matcha / green aesthetic --- */
  :root{
    --bg: #f5fff6;
    --panel: #ecf9ee;
    --card: #e6f4e9;
    --muted: #487056;
    --text: #063018;
    --accent: #6bbf6b;
    --accent-2: #4ea1a1;
    --bad: #e05252;
    --ok: #2e7d32;
    --glass: rgba(6,48,24,0.04);
    --radius: 16px;
    --shadow: 0 10px 30px rgba(5,50,12,0.06);
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{margin:0; background:linear-gradient(180deg,#f7fff8 0,#ecfff2 100%); color:var(--text); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .wrap{max-width:1100px; margin:24px auto; padding:20px;}
  header{display:flex; align-items:center; gap:18px; margin-bottom:18px}
  .logo{display:flex; gap:12px; align-items:center}
  .logo .mark {width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:white;font-weight:800;box-shadow:var(--shadow)}
  h1{font-size:1.6rem;margin:0}
  .tag{color:var(--muted);font-size:0.95rem}

  nav{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0}
  .tab{padding:8px 12px;border-radius:999px;background:transparent;border:1px solid rgba(6,48,24,0.06);cursor:pointer;color:var(--muted);font-weight:700}
  .tab.active{background:linear-gradient(90deg, rgba(107,191,107,0.12), rgba(78,161,161,0.08)); border-color: rgba(6,48,24,0.08); color:var(--text)}
  
  /* page layout */
  .content{display:grid; grid-template-columns: 1fr 320px; gap:18px;}
  @media (max-width:980px){ .content{grid-template-columns:1fr} .side {order:2} .main {order:1} }

  .panel{background:var(--panel); border-radius:var(--radius); padding:16px; box-shadow:var(--shadow); border:1px solid rgba(6,48,24,0.04)}
  .muted{color:var(--muted)}
  .lead{margin-top:6px;color:var(--muted)}

  /* game header */
  .game-controls{display:flex; gap:10px; align-items:center; margin-bottom:12px}
  .btn{background:var(--accent); color:#032; padding:8px 12px; border-radius:999px; border:none; cursor:pointer; font-weight:700}
  .btn.ghost{background:transparent;border:1px solid rgba(6,48,24,0.06); color:var(--muted)}
  .small{font-size:0.9rem}

  /* Recycle Sorting area */
  .board{display:grid; grid-template-columns: 1fr 320px; gap:14px}
  @media (max-width:980px){ .board{grid-template-columns:1fr} }

  .left{display:flex; flex-direction:column; gap:12px}
  .items{display:flex; flex-wrap:wrap; gap:10px; padding:6px}
  .item{
    min-width:150px; background:linear-gradient(180deg,#ffffff,#f0fff0); border-radius:12px; padding:10px; display:flex; gap:10px; align-items:center;
    border:1px solid rgba(6,48,24,0.06); cursor:grab; user-select:none; transition: transform .12s ease, box-shadow .12s;
  }
  .item:active{cursor:grabbing}
  .item.hidden{opacity:0.15; transform:scale(.98); pointer-events:none}
  .emoji{font-size:1.5rem}
  .meta{display:flex;flex-direction:column}
  .title{font-weight:800}
  .desc{font-size:0.88rem;color:var(--muted)}

  .bins{display:flex; flex-direction:column; gap:12px; padding:6px}
  .bin{background:var(--card); border-radius:12px; padding:12px; min-height:110px; border:2px dashed rgba(6,48,24,0.06); transition: all .12s ease; display:flex; flex-direction:column; gap:8px}
  .bin.dragover{border-color:var(--accent); box-shadow:0 8px 20px rgba(78,161,161,0.08); transform:translateY(-4px)}
  .bin .lbl{font-weight:800; display:flex; justify-content:space-between; align-items:center}
  .bin-list{display:flex; flex-direction:column; gap:8px; margin-top:6px}

  /* scoreboard */
  .score{display:flex; gap:8px; align-items:center; justify-content:space-between; margin-top:8px}
  .score .big{font-size:1.4rem; font-weight:900}
  .pill{background:rgba(6,48,24,0.04); padding:6px 10px; border-radius:999px; font-weight:700}

  .result{padding:10px;border-radius:10px;font-weight:800;text-align:center}
  .result.ok{color:var(--ok);background:rgba(46,125,50,0.08);border:1px solid rgba(46,125,50,0.12)}
  .result.warn{color:#b07a00;background:rgba(176,122,0,0.06);border:1px solid rgba(176,122,0,0.08)}
  .result.bad{color:var(--bad);background:rgba(224,82,82,0.06);border:1px solid rgba(224,82,82,0.08)}

  /* badges */
  .badges{display:flex; gap:8px; flex-wrap:wrap}
  .badge{padding:8px 10px;border-radius:10px;background:linear-gradient(90deg, rgba(255,255,255,0.5), rgba(255,255,255,0.2)); font-weight:800; border:1px solid rgba(6,48,24,0.04)}

  /* Tree Planting & Ocean Cleanup simple UI */
  .mini-play{display:flex; gap:12px; align-items:center; justify-content:center; padding:16px}
  .plant-plot{width:220px;height:160px;border-radius:12px;background:linear-gradient(180deg,#9fe6a0,#57b76b);display:flex;align-items:flex-end;justify-content:center;padding:12px;position:relative}
  .seed{padding:8px 12px;border-radius:999px;background:#fff8;text-align:center;cursor:pointer;font-weight:800}
  .ocean{background:linear-gradient(180deg,#bde8ff,#76c6e6);height:160px;border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:8px;justify-content:center;align-items:center}

  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:0.9rem}
  /* focus outlines */
  .item:focus{outline:3px solid rgba(78,161,161,0.14); outline-offset:3px}
  button:focus{outline:3px solid rgba(107,191,107,0.12); outline-offset:3px}

  /* small responsive */
  @media (max-width:520px){
    .item{min-width:120px}
    .logo h1{font-size:1.1rem}
  }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">
      <div class="mark">GQ</div>
      <div>
        <h1>GreenQuest</h1>
        <div class="tag">Learn sustainability through play ‚Äî free for schools & NGOs</div>
      </div>
    </div>
  </header>

  <nav>
    <button class="tab active" data-tab="home">Home</button>
    <button class="tab" data-tab="recycle">‚ôªÔ∏è Recycle Sorting</button>
    <button class="tab" data-tab="plant">üå± Tree Planting</button>
    <button class="tab" data-tab="ocean">üåä Ocean Cleanup</button>
    <button class="tab" data-tab="about">About / Roadmap</button>
  </nav>

  <div class="content">
    <!-- MAIN -->
    <main class="main panel" id="mainPanel">

      <!-- HOME -->
      <section data-page="home" class="page" aria-hidden="false">
        <h2>Welcome to GreenQuest</h2>
        <p class="lead">GreenQuest makes environmental education fun with bite-sized browser games that work on low bandwidth and don't require installs. Start with Recycle Sorting ‚Äî then try Tree Planting and Ocean Cleanup.</p>
        <div style="margin-top:12px" class="panel">
          <h3 class="muted">Quick start</h3>
          <p class="small muted">Choose a game from the tabs above. Play, score points, and earn eco-badges ‚Äî perfect for classrooms and outreach programs.</p>
        </div>
      </section>

      <!-- RECYCLE SORTING -->
      <section data-page="recycle" class="page" style="display:none" aria-hidden="true">
        <div class="game-controls">
          <div style="display:flex; gap:8px; align-items:center">
            <label class="small muted">Level:</label>
            <select id="levelSelect" class="pill" aria-label="Choose level">
              <option value="easy">Easy (60s)</option>
              <option value="medium">Medium (45s)</option>
              <option value="hard">Hard (30s)</option>
            </select>
          </div>

          <div style="margin-left:auto; display:flex; gap:8px; align-items:center">
            <button class="btn" id="startBtn">Start</button>
            <button class="btn ghost" id="resetBtn">Reset</button>
          </div>
        </div>

        <div class="board">
          <div class="left panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="muted">Items to sort</div>
                <div class="small">Drag items into the correct bin (or tap to cycle on mobile)</div>
              </div>
              <div class="small muted">High score: <span id="highScore">0</span></div>
            </div>

            <div id="itemsArea" class="items" aria-live="polite" tabindex="0"></div>

            <div style="display:flex;gap:8px;align-items:center;margin-top:8px">
              <div class="score"><div class="small muted">Time</div><div class="big" id="timerDisplay">‚Äî</div></div>
              <div class="score"><div class="small muted">Score</div><div class="big" id="scoreDisplay">0</div></div>
              <div style="margin-left:auto"><button class="btn ghost" id="checkBtn">Check</button></div>
            </div>

            <div id="factBox" style="margin-top:10px; display:none" class="result warn" aria-live="polite"></div>
          </div>

          <aside class="side panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div class="muted">Bins</div>
                <div class="small muted">Drop here</div>
              </div>
              <div class="muted">üèÖ Badges</div>
            </div>

            <div class="bins" style="margin-top:8px">
              <div class="bin" id="bin-bio" data-accept="bio" tabindex="0" aria-label="Biodegradable bin">
                <div class="lbl"><span>Biodegradable</span><span class="muted">üçÉ</span></div>
                <div class="bin-list" id="bioList"></div>
                <div class="score"><div class="small muted">Correct</div><div class="pill" id="bioCount">0</div></div>
              </div>

              <div class="bin" id="bin-non" data-accept="non" tabindex="0" aria-label="Non-biodegradable bin">
                <div class="lbl"><span>Non-biodegradable</span><span class="muted">üóëÔ∏è</span></div>
                <div class="bin-list" id="nonList"></div>
                <div class="score"><div class="small muted">Correct</div><div class="pill" id="nonCount">0</div></div>
              </div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Achievements</div>
              <div class="badges" id="earnedBadges" style="margin-top:8px"></div>
            </div>

            <div style="margin-top:12px">
              <div class="muted">Game tips</div>
              <ul style="margin:8px 0 0 18px" class="small muted">
                <li>Correct placements = +10 points</li>
                <li>Wrong placements = ‚àí5 points + hint</li>
                <li>Finish level before time to earn badges</li>
              </ul>
            </div>
          </aside>
        </div>
      </section>

      <!-- TREE PLANTING -->
      <section data-page="plant" class="page" style="display:none" aria-hidden="true">
        <h2>üå± Tree Planting ‚Äî Quick Demo</h2>
        <p class="muted small">Plant seeds and water them to grow trees. Earn a Sapling badge when a sapling reaches size threshold.</p>
        <div class="mini-play panel" style="margin-top:12px">
          <div style="text-align:center">
            <div class="plant-plot" id="plot">
              <div id="tree" style="width:20px;height:20px;border-radius:50%;background:#2e7d32;transform:translateY(6px);transition:all .18s"></div>
            </div>
            <div style="margin-top:10px; display:flex; gap:8px; justify-content:center">
              <button class="btn" id="seedBtn">Plant Seed</button>
              <button class="btn ghost" id="waterBtn">Water</button>
              <button class="btn ghost" id="harvestBtn">Harvest</button>
            </div>
            <div id="plantMsg" style="margin-top:8px" class="muted small">Status: empty</div>
          </div>
        </div>
      </section>

      <!-- OCEAN CLEANUP -->
      <section data-page="ocean" class="page" style="display:none" aria-hidden="true">
        <h2>üåä Ocean Cleanup ‚Äî Quick Demo</h2>
        <p class="muted small">Collect floating trash into your boat. Each correct item increases your cleanup score.</p>
        <div class="panel" style="margin-top:12px">
          <div class="ocean" id="oceanArea">
            <div id="boat" style="width:140px;height:60px;background:#fbfbfb;border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.06);cursor:pointer">
              üö§ Boat ‚Äî Click to collect
            </div>
            <div id="trashRow" style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap;justify-content:center"></div>
            <div style="margin-top:10px; display:flex;justify-content:center; gap:8px">
              <div class="muted small">Collected: <span id="oceanScore">0</span></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ABOUT / ROADMAP -->
      <section data-page="about" class="page" style="display:none" aria-hidden="true">
        <h2>About GreenQuest</h2>
        <p class="muted">Environmental education in schools is often limited to theory. GreenQuest offers lightweight browser games (Recycle Sorting, Tree Planting, Ocean Cleanup) to combine play with learning and improve adoption of eco habits.</p>
        <h3 style="margin-top:12px">Roadmap</h3>
        <ul class="muted">
          <li>Phase 1: Beginner games & classroom integration</li>
          <li>Phase 2: Advanced eco-simulations (carbon tracker, eco-city)</li>
          <li>Phase 3: NGO/CSR partnerships, school programs, premium customization</li>
        </ul>
      </section>
    </main>

    <!-- SIDE PANEL (shared tips / scoreboard) -->
    <aside class="side panel">
      <div>
        <h3 class="muted">Session</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <div class="small muted">Current Level: <strong id="sessionLevel">‚Äî</strong></div>
          <div class="small muted">Best Score (local): <strong id="localBest">0</strong></div>
          <div class="small muted">Badges Earned (this session):</div>
          <div id="panelBadges" class="badges"></div>
        </div>
      </div>

      <div style="margin-top:12px">
        <h4 class="muted">How to use</h4>
        <ol class="muted small">
          <li>Select a game tab</li>
          <li>Pick a level, press Start</li>
          <li>Drag, drop, or tap items ‚Äî use keyboard: focus item + Space</li>
        </ol>
      </div>

      <div style="margin-top:12px; text-align:center">
        <button class="btn" id="resetAll">Reset All Progress</button>
      </div>
    </aside>
  </div>

  <footer>
    ¬© 2025 GreenQuest ‚Äî Free for schools ‚Ä¢ Built for eco-education
  </footer>
</div>

<script>
/* ----------------------------
   GreenQuest: Multi-Game Platform
   Vanilla JS ‚Äî small, modular blocks
   ---------------------------- */

(() => {
  /* --- Utilities --- */
  const $ = (sel, root = document) => root.querySelector(sel);
  const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));
  const rand = (arr) => arr[Math.floor(Math.random()*arr.length)];

  /* --- Tabs / Page navigation --- */
  const tabs = $$('.tab');
  const pages = $$('.page');
  tabs.forEach(t => t.addEventListener('click', () => {
    tabs.forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    const tab = t.dataset.tab;
    pages.forEach(p => {
      const show = p.dataset.page === tab || (tab === 'home' && p.dataset.page === 'home');
      p.style.display = show ? '' : 'none';
      p.setAttribute('aria-hidden', !show);
    });
  }));

  /* -----------------------------
     Shared data and highscore storage
     ----------------------------- */
  const STORE_KEY = 'greenquest_highscores_v1';
  const store = JSON.parse(localStorage.getItem(STORE_KEY) || '{}');

  function saveScore(game, score) {
    if(!store[game] || score > store[game]) {
      store[game] = score;
      localStorage.setItem(STORE_KEY, JSON.stringify(store));
    }
  }

  /* -----------------------------
     RECYCLE SORTING GAME
     ----------------------------- */
  const recycle = (() => {
    // DOM
    const itemsArea = $('#itemsArea');
    const bioList = $('#bioList');
    const nonList = $('#nonList');
    const bioCount = $('#bioCount');
    const nonCount = $('#nonCount');
    const startBtn = $('#startBtn');
    const resetBtn = $('#resetBtn');
    const checkBtn = $('#checkBtn');
    const levelSelect = $('#levelSelect');
    const timerDisplay = $('#timerDisplay');
    const scoreDisplay = $('#scoreDisplay');
    const factBox = $('#factBox');
    const highScoreEl = $('#highScore');
    const earnedBadges = $('#earnedBadges');
    const sessionLevel = $('#sessionLevel');
    const panelBadges = $('#panelBadges');
    const localBest = $('#localBest');

    // items bank (id, emoji, title, type, fact)
    const BANK = [
      {id:'apple', e:'üçé', t:'Apple core', type:'bio', fact:'Apple cores are compostable and enrich soil.'},
      {id:'banana', e:'üçå', t:'Banana peel', type:'bio', fact:'Banana peels decompose quickly and can be composted.'},
      {id:'leaves', e:'üçÇ', t:'Dry leaves', type:'bio', fact:'Leaves make excellent compost material.'},
      {id:'paper', e:'üìÑ', t:'Paper scrap', type:'bio', fact:'Paper is biodegradable but best recycled.'},
      {id:'bottle', e:'ü•§', t:'Plastic bottle', type:'non', fact:'PET bottles are recyclable at collection points.'},
      {id:'bag', e:'üõçÔ∏è', t:'Plastic bag', type:'non', fact:'Plastic bags take centuries to break down.'},
      {id:'battery', e:'üîã', t:'Battery', type:'non', fact:'Batteries require special hazardous waste disposal.'},
      {id:'can', e:'ü•´', t:'Metal can', type:'non', fact:'Metal cans are highly recyclable.'},
      {id:'styro', e:'üç¶', t:'Styrofoam cup', type:'non', fact:'Styrofoam is not biodegradable and clogs ecosystems.'}
    ];

    // game state
    let activeItems = []; // current round items DOM
    let timer = null, timeLeft = 0;
    let score = 0;
    let running = false;
    let badges = new Set();

    // levels config
    const LEVELS = {
      easy: 60,
      medium: 45,
      hard: 30
    };

    function setHighScoreUI() {
      const hs = (store['recycle'] || 0);
      highScoreEl.textContent = hs;
      localBest.textContent = hs;
    }

    function makeItemNode(data) {
      const div = document.createElement('div');
      div.className = 'item';
      div.draggable = true;
      div.id = 'itm-' + data.id + '-' + Math.random().toString(36).slice(2,7);
      div.dataset.type = data.type;
      div.dataset.key = data.id; // for facts
      div.tabIndex = 0;
      div.innerHTML = `<div class="emoji">${data.e}</div><div class="meta"><div class="title">${data.t}</div><div class="desc">${data.type === 'bio' ? 'Biodegradable' : 'Non-biodegradable'}</div></div>`;
      // drag events
      div.addEventListener('dragstart', (ev) => {
        ev.dataTransfer.setData('text/plain', div.id);
        setTimeout(()=>div.classList.add('hidden'), 0);
      });
      div.addEventListener('dragend', () => div.classList.remove('hidden'));
      // keyboard support: focus + Space/Enter -> choose bin (B or N)
      div.addEventListener('keydown', (e) => {
        if(e.key === ' ' || e.key === 'Enter') {
          e.preventDefault();
          showKeyboardPlacement(div);
        }
      });
      // touch support: tap cycles
      div.addEventListener('touchend', (e) => {
        e.preventDefault();
        cyclePlacement(div);
      });
      return div;
    }

    function buildRound(level) {
      // pick number of items by level
      const count = level === 'easy' ? 5 : (level === 'medium' ? 7 : 9);
      const pool = BANK.slice(); // shallow copy
      // shuffle and take count
      const picked = [];
      while(picked.length < count && pool.length) {
        const idx = Math.floor(Math.random()*pool.length);
        picked.push(...pool.splice(idx,1));
      }
      // clear UI
      itemsArea.innerHTML = '';
      bioList.innerHTML = '';
      nonList.innerHTML = '';
      factBox.style.display = 'none';
      activeItems = picked.map(d => {
        const node = makeItemNode(d);
        itemsArea.appendChild(node);
        return node;
      });
      updateCounts();
      score = 0; updateScoreUI();
      // bind bins
      bindBins();
      setHighScoreUI();
      $('#sessionLevel').textContent = level;
    }

    function bindBins() {
      const bins = [$('#bin-bio'), $('#bin-non')];
      bins.forEach(bin => {
        bin.addEventListener('dragover', (e) => {
          e.preventDefault(); bin.classList.add('dragover');
        });
        bin.addEventListener('dragleave', () => bin.classList.remove('dragover'));
        bin.addEventListener('drop', (e) => {
          e.preventDefault();
          bin.classList.remove('dragover');
          const id = e.dataTransfer.getData('text/plain');
          const el = document.getElementById(id);
          if(!el) return;
          const target = bin.dataset.accept;
          placeItem(el, target);
        });
      });
    }

    function placeItem(el, target) {
      // move element into bin list
      const list = target === 'bio' ? bioList : nonList;
      list.appendChild(el);
      // update counters & score
      if(el.dataset.type === target) {
        score += 10;
        flashResult('ok', `${el.querySelector('.title').textContent} ‚Äî correct! +10`);
      } else {
        score -= 5;
        showFact(el.dataset.key);
        flashResult('bad', `Wrong bin ‚Äî ${el.querySelector('.title').textContent} ‚Äî ‚àí5`);
      }
      updateCounts();
      updateScoreUI();
    }

    function updateCounts() {
      const bioCorrect = Array.from(bioList.querySelectorAll('.item')).filter(it => it.dataset.type === 'bio').length;
      const nonCorrect = Array.from(nonList.querySelectorAll('.item')).filter(it => it.dataset.type === 'non').length;
      bioCount.textContent = bioCorrect;
      nonCount.textContent = nonCorrect;
    }

    function updateScoreUI() {
      scoreDisplay.textContent = score;
    }

    // Timer functions
    function startTimer(sec) {
      timeLeft = sec;
      timerDisplay.textContent = timeLeft + 's';
      if(timer) clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerDisplay.textContent = timeLeft + 's';
        if(timeLeft <= 0) {
          clearInterval(timer);
          endRound();
        }
      }, 1000);
    }

    function stopTimer() {
      if(timer) clearInterval(timer);
      timer = null;
    }

    function endRound() {
      running = false;
      // evaluate placed items
      const placed = [...bioList.querySelectorAll('.item'), ...nonList.querySelectorAll('.item')];
      const correct = placed.filter(it => (it.parentElement.id === 'bioList' ? it.dataset.type === 'bio' : it.dataset.type === 'non')).length;
      const total = placed.length;
      // finalize score bonus for remaining unplaced correct items
      const unplaced = activeItems.filter(it => it.parentElement.id === 'itemsArea');
      unplaced.forEach(it => {
        // no penalty but no points
      });
      // award badges
      const pct = total === 0 ? 0 : Math.round((correct/total)*100);
      let msg = `Round complete ‚Äî ${correct}/${total} correct (${pct}%)`;
      if(pct >= 80) {
        awardBadge('Gold Recycler'); msg += ' ‚Äî Gold badge awarded!';
      } else if(pct >= 50) { awardBadge('Silver Recycler'); msg += ' ‚Äî Silver badge!'; }
      else { awardBadge('Bronze Recycler'); }
      flashResult(pct >= 80 ? 'ok' : (pct >= 50 ? 'warn' : 'bad'), msg);
      saveScore('recycle', score);
      setHighScoreUI();
      updatePanelBadges();
    }

    function resetRound() {
      stopTimer();
      running = false;
      // move all items back to area (preserve original activeItems)
      activeItems.forEach(it => itemsArea.appendChild(it));
      bioList.innerHTML = '';
      nonList.innerHTML = '';
      score = 0; updateScoreUI();
      updateCounts();
      factBox.style.display = 'none';
      $('#resultBox') && ($('#resultBox').style.display = 'none');
    }

    function flashResult(type, text) {
      const box = document.createElement('div');
      box.className = 'result ' + (type === 'ok' ? 'ok' : (type === 'warn' ? 'warn' : 'bad'));
      box.textContent = text;
      itemsArea.parentElement.insertBefore(box, itemsArea);
      setTimeout(()=>box.remove(), 2800);
    }

    function showFact(key) {
      // find fact in BANK by id
      const data = BANK.find(x => x.id === key);
      if(!data) return;
      factBox.style.display = 'block';
      factBox.textContent = 'üí° ' + data.fact;
    }

    // keyboard placement helper
    function showKeyboardPlacement(el) {
      const onKey = (ev) => {
        const k = ev.key.toLowerCase();
        if(k === 'b') { placeItem(el, 'bio'); window.removeEventListener('keydown', onKey); }
        else if(k === 'n') { placeItem(el, 'non'); window.removeEventListener('keydown', onKey); }
        else if(k === 'escape') { window.removeEventListener('keydown', onKey); }
      };
      // instruct user
      flashResult('warn', 'Press B for Biodegradable or N for Non-biodegradable (Esc to cancel)');
      window.addEventListener('keydown', onKey);
    }

    // mobile tap cycle
    function cyclePlacement(el) {
      const parent = el.parentElement.id;
      if(parent === 'itemsArea') { bioList.appendChild(el); placeItem(el, 'bio'); }
      else if(parent === 'bioList') { nonList.appendChild(el); placeItem(el, 'non'); }
      else { itemsArea.appendChild(el); updateCounts(); }
    }

    // award badges (session-level)
    function awardBadge(name) {
      badges.add(name);
      // persist local best (store badges count)
      saveScore('recycle_badges', badges.size);
    }

    function updatePanelBadges() {
      earnedBadges.innerHTML = '';
      panelBadges.innerHTML = '';
      badges.forEach(b => {
        const d = document.createElement('div'); d.className = 'badge'; d.textContent = b;
        earnedBadges.appendChild(d);
        const p = d.cloneNode(true); panelBadges.appendChild(p);
      });
    }

    // check / scoring button
    checkBtn.addEventListener('click', () => {
      // evaluate placements and show immediate facts for wrong ones
      const placed = [...bioList.querySelectorAll('.item'), ...nonList.querySelectorAll('.item')];
      let correct = 0;
      placed.forEach(it => {
        const parent = it.parentElement.id === 'bioList' ? 'bio' : 'non';
        if(it.dataset.type === parent) correct++;
        else showFact(it.dataset.key);
      });
      const total = placed.length;
      const pct = total === 0 ? 0 : Math.round((correct/total)*100);
      flashResult(pct >= 80 ? 'ok' : (pct >= 50 ? 'warn' : 'bad'), `Check: ${correct}/${total} correct (${pct}%)`);
    });

    // start and reset controls
    startBtn.addEventListener('click', () => {
      if(running) return;
      const level = levelSelect.value;
      buildRound(level);
      running = true;
      score = 0; updateScoreUI();
      startTimer(LEVELS[level]);
      factBox.style.display = 'none';
    });
    resetBtn.addEventListener('click', resetRound);

    // Expose some functions
    return {
      init: () => {
        setHighScoreUI();
        // initialize UI with easy level round
        buildRound('easy');
        // show persistent highscore
        localBest.textContent = store['recycle'] || 0;
      }
    };
  })();

  /* -----------------------------
     TREE PLANTING DEMO
     ----------------------------- */
  const planting = (() => {
    const seedBtn = $('#seedBtn'), waterBtn = $('#waterBtn'), harvestBtn = $('#harvestBtn');
    const plot = $('#plot'), tree = $('#tree'), plantMsg = $('#plantMsg');
    let planted = false, waterCount = 0, size = 20;

    seedBtn.addEventListener('click', () => {
      if(planted) { plantMsg.textContent = 'A seed is already planted.'; return; }
      planted = true; waterCount = 0; size = 20;
      tree.style.width = size + 'px'; tree.style.height = size + 'px';
      plantMsg.textContent = 'Seed planted ‚Äî water to grow!';
    });
    waterBtn.addEventListener('click', () => {
      if(!planted) { plantMsg.textContent = 'No seed planted. Click Plant Seed.'; return; }
      waterCount++;
      size += 8;
      tree.style.width = size + 'px'; tree.style.height = size + 'px'; tree.style.transform = 'translateY(0)';
      plantMsg.textContent = `Watered ${waterCount} time(s). Growth: ${Math.round(size)}px`;
      if(size >= 60) {
        plantMsg.textContent = 'üå≥ Sapling grown! Badge: Sapling Planter earned.';
        // award little badge in panel
        const b = document.createElement('div'); b.className='badge'; b.textContent='Sapling Planter';
        $('#panelBadges').appendChild(b);
      }
    });
    harvestBtn.addEventListener('click', () => {
      if(!planted) { plantMsg.textContent = 'Nothing to harvest.'; return; }
      planted = false; waterCount = 0;
      tree.style.width = '20px'; tree.style.height = '20px'; tree.style.transform = 'translateY(6px)';
      plantMsg.textContent = 'Harvested (demo). You can plant again.';
    });

    return { init: () => {} };
  })();

  /* -----------------------------
     OCEAN CLEANUP DEMO
     ----------------------------- */
  const ocean = (() => {
    const trashRow = $('#trashRow'), boat = $('#boat'), oceanScore = $('#oceanScore');
    const trashBank = [
      {id:'bag', e:'üõçÔ∏è', good:false, info:'Plastic bags harm marine life.'},
      {id:'bottle', e:'ü•§', good:false, info:'Plastic bottles fragment into microplastics.'},
      {id:'log', e:'ü™µ', good:true, info:'Natural logs are not trash; leave them.'},
      {id:'can', e:'ü•´', good:false, info:'Cans are litter but recyclable.'},
      {id:'net', e:'ü™ù', good:false, info:'Fishing nets entangle animals.'}
    ];
    let score = 0;
    function spawn() {
      trashRow.innerHTML = '';
      // spawn five random pieces
      for(let i=0;i<5;i++){
        const t = rand(trashBank);
        const d = document.createElement('div');
        d.className = 'item';
        d.dataset.key = t.id;
        d.dataset.good = t.good;
        d.innerHTML = `<div class="emoji">${t.e}</div><div class="meta"><div class="title">${t.id}</div><div class="desc small muted">${t.info}</div></div>`;
        d.addEventListener('click', () => {
          // click to pick up (simulate)
          if(d.style.opacity === '0.35') return;
          d.style.opacity = '0.35';
          if(t.good) { score -= 2; flash('bad','That was not trash ‚Äî ‚àí2'); }
          else { score += 5; flash('ok','Collected! +5'); oceanScore.textContent = score; }
        });
        trashRow.appendChild(d);
      }
    }
    function flash(type, text) {
      const box = document.createElement('div'); box.className = 'result ' + (type==='ok' ? 'ok' : 'bad'); box.textContent = text;
      trashRow.parentElement.insertBefore(box, trashRow);
      setTimeout(()=>box.remove(),2200);
    }
    boat.addEventListener('click', () => {
      // collect all non-picked items that are trash
      const nodes = Array.from(trashRow.querySelectorAll('.item'));
      let collected = 0;
      nodes.forEach(n => {
        if(n.style.opacity === '0.35') return; // already picked
        const good = (n.dataset.good === 'true');
        if(!good) { score += 5; collected++; n.style.opacity = '0.35'; }
      });
      oceanScore.textContent = score;
      if(collected>0) flash('ok', `Boat collected ${collected} items!`);
      else flash('warn','No trash collected.');
    });

    return {
      init: () => {
        spawn();
      }
    };
  })();

  /* -----------------------------
     Session controls
     ----------------------------- */
  $('#resetAll').addEventListener('click', () => {
    if(confirm('Reset local progress and highscores?')) {
      localStorage.removeItem('greenquest_highscores_v1');
      location.reload();
    }
  });

  /* -----------------------------
     Init everything
     ----------------------------- */
  recycle.init();
  planting.init();
  ocean.init();

  // show home page by default (tabs already wired)
})();
</script>
</body>
</html>
